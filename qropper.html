<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Resizer + Freeform Crop</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      margin-top: 40px;
      background: #1e1e1e;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.6);
      width: 600px;
      max-width: 95%;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #ffffff;
    }
    label {
      display: block;
      margin: 15px 0 8px;
      font-weight: bold;
      color: #b0b0b0;
    }
    input[type="file"], 
    input[type="url"], 
    input[type="number"], 
    input[type="color"] {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: #e0e0e0;
    }
    input[type="number"] {
      width: 48%;
      display: inline-block;
    }
    .number-group {
      display: flex;
      justify-content: space-between;
      gap: 4%;
    }
    button {
      background: #333;
      border: none;
      color: #fff;
      padding: 10px 18px;
      border-radius: 8px;
      margin-top: 15px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    button:hover {
      background: #555;
    }
    .preview {
      margin-top: 25px;
      text-align: center;
    }
    canvas {
      max-width: 100%;
      border: 1px solid #333;
      border-radius: 8px;
      background: #000;
    }
    .crop-controls {
      display: none;
      margin-top: 10px;
    }
    .crop-controls button {
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üñºÔ∏è Image Resizer</h1>

    <label for="bgColor">Background Color:</label>
    <input type="color" id="bgColor" value="#000000">

    <label for="fileInput">Choose Image File:</label>
    <input type="file" id="fileInput" accept="image/*">

    <label for="urlInput">Or Enter Image URL:</label>
    <input type="url" id="urlInput" placeholder="https://example.com/image.jpg">

    <label>Or Paste Image (Ctrl+V)</label>
    <p style="font-size: 12px; color: #777; margin-top: -5px;">Paste an image directly into this page.</p>

    <label>Target Size:</label>
    <div class="number-group">
      <input type="number" id="widthInput" value="1920" min="1"> 
      <input type="number" id="heightInput" value="1080" min="1">
    </div>

    <button onclick="resizeAndShow()">Resize</button>
    <button onclick="saveImage()">Save as JPG</button>
    <button onclick="enterCropMode()">Crop</button>

    <div class="crop-controls" id="cropControls">
      <button onclick="applyCrop()">Apply Crop</button>
      <button onclick="cancelCrop()">Cancel</button>
    </div>

    <div class="preview">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const urlInput = document.getElementById('urlInput');
    const bgColor = document.getElementById('bgColor');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const cropControls = document.getElementById('cropControls');

    let currentImage = null;
    let originalImage = null;
    let cropMode = false;
    let isDragging = false;
    let cropRect = null;
    let dragStartX = 0, dragStartY = 0;

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => loadImage(evt.target.result);
      reader.readAsDataURL(file);
    });

    urlInput.addEventListener('change', e => {
      if (e.target.value) loadImage(e.target.value);
    });

    document.addEventListener('paste', e => {
      const items = e.clipboardData.items;
      for (let item of items) {
        if (item.type.startsWith('image')) {
          const blob = item.getAsFile();
          const reader = new FileReader();
          reader.onload = evt => loadImage(evt.target.result);
          reader.readAsDataURL(blob);
        }
      }
    });

    function loadImage(src) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
        currentImage = img;
        originalImage = img;
        resizeAndShow();
      };
      img.src = src;
    }

    function resizeAndShow() {
      if (!currentImage) return;
      const targetW = parseInt(document.getElementById('widthInput').value, 10);
      const targetH = parseInt(document.getElementById('heightInput').value, 10);
      canvas.width = targetW;
      canvas.height = targetH;
      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, targetW, targetH);
      const scale = Math.min(targetW / currentImage.width, targetH / currentImage.height);
      const newW = currentImage.width * scale;
      const newH = currentImage.height * scale;
      const offsetX = (targetW - newW) / 2;
      const offsetY = (targetH - newH) / 2;
      ctx.drawImage(currentImage, offsetX, offsetY, newW, newH);
    }

    function saveImage() {
      if (!currentImage) return;
      const link = document.createElement('a');
      link.download = 'resized.jpg';
      link.href = canvas.toDataURL('image/jpeg', 0.92);
      link.click();
    }

    // ---- Crop Mode ----
    function enterCropMode() {
      if (!originalImage) return;
      cropMode = true;
      cropRect = null;

      // show image at original resolution
      canvas.width = originalImage.naturalWidth || originalImage.width;
      canvas.height = originalImage.naturalHeight || originalImage.height;
      ctx.drawImage(originalImage, 0, 0);

      cropControls.style.display = "block";
    }

    function cancelCrop() {
      cropMode = false;
      cropRect = null;
      resizeAndShow();
      cropControls.style.display = "none";
    }

    function applyCrop() {
      if (!cropRect || !originalImage) return;
      const {x, y, w, h} = cropRect;

      const croppedCanvas = document.createElement('canvas');
      croppedCanvas.width = w;
      croppedCanvas.height = h;
      const croppedCtx = croppedCanvas.getContext('2d');
      croppedCtx.drawImage(originalImage, x, y, w, h, 0, 0, w, h);

      const img = new Image();
      img.onload = () => {
        currentImage = img;
        resizeAndShow(); // auto resize after crop
      };
      img.src = croppedCanvas.toDataURL();

      cropMode = false;
      cropRect = null;
      cropControls.style.display = "none";
    }

    canvas.addEventListener('mousedown', e => {
      if (!cropMode) return;
      const rect = canvas.getBoundingClientRect();
      dragStartX = e.clientX - rect.left;
      dragStartY = e.clientY - rect.top;
      isDragging = true;
    });

    canvas.addEventListener('mousemove', e => {
      if (!cropMode || !isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      cropRect = {
        x: Math.min(dragStartX, mouseX),
        y: Math.min(dragStartY, mouseY),
        w: Math.abs(mouseX - dragStartX),
        h: Math.abs(mouseY - dragStartY)
      };
      ctx.drawImage(originalImage, 0, 0);
      if (cropRect) {
        ctx.strokeStyle = "red";
        ctx.lineWidth = 2;
        ctx.strokeRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
        ctx.fillStyle = "rgba(255,0,0,0.2)";
        ctx.fillRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
      }
    });

    canvas.addEventListener('mouseup', e => {
      if (!cropMode) return;
      isDragging = false;
    });
  </script>
</body>
</html>
